/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t="apf-cohort-202",e="18e65fe6-f22e-4549-8c48-91a029fe4686",n=function(){return fetch("https://mesto.nomoreparties.co/v1/".concat(t,"/users/me"),{headers:{authorization:e}}).then(o).then(function(t){return t})};function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var r=document.querySelector(".places__list");function c(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=document.querySelector("#card-template").content.cloneNode(!0);c&&n.some(function(t){return t._id===c._id})&&a.querySelector(".card__like-button").classList.add("card__like-button_is-active"),a.querySelector(".card").dataset.cardId=r,a.querySelector(".card__image").src=t,a.querySelector(".card__image").alt=e,a.querySelector(".card__title").textContent=e,a.querySelector(".card__likes").textContent=n.length;var i=a.querySelector(".card__delete-button");return c?o&&o._id!==c._id&&(i.style.display="none"):i.style.display="none",a}function a(n){r.innerHTML="",fetch("https://mesto.nomoreparties.co/v1/".concat(t,"/cards"),{headers:{authorization:e}}).then(o).then(function(t){t.forEach(function(t){r.append(c(t.link,t.name,t.likes,t.owner,t._id,n))})}).catch(function(t){console.error("Ошибка загрузки карточек:",t)})}function i(t){return t.querySelector(".card__like-button").classList.contains("card__like-button_is-active")}function u(t){var e=t.querySelector(".card__like-button"),n=t.querySelector(".card__likes");e.classList.add("card__like-button_is-active"),n.textContent=parseInt(n.textContent)+1}function s(t){var e=t.querySelector(".card__like-button"),n=t.querySelector(".card__likes");e.classList.remove("card__like-button_is-active"),n.textContent=parseInt(n.textContent)-1}function l(t,e){var n=t.every(function(t){return t.validity.valid});e.disabled=!n,e.classList.toggle("popup__button_disabled",!n)}var d=document.querySelector(".popup_type_new-card"),p=document.querySelector(".popup_type_image"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_updAvatar"),v=document.querySelectorAll(".popup__close");function y(t){"Escape"===t.key&&h()}function m(t){t.classList.add("popup_is-opened"),document.body.style.overflow="hidden",document.addEventListener("keydown",y)}function h(){document.querySelectorAll(".popup_is-opened").forEach(function(t){return t.classList.remove("popup_is-opened")}),document.body.style.overflow="",document.removeEventListener("keydown",y)}document.querySelectorAll(".popup").forEach(function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",function(e){e.target===t&&h()})});var b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),q=function(){n().then(function(t){b.textContent=t.name,S.textContent=t.about,g.style.backgroundImage="url(".concat(t.avatar,")")}).then(function(t){}).catch(function(t){console.error("Ошибка загрузки профиля:",t)})},k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description");function L(t){var e=new FormData(t);return Object.fromEntries(e)}function C(n){var r=n.target.querySelector(".popup__button"),c=r.textContent;r.textContent="Сохранение...",n.preventDefault();var a=L(n.target),i=a.name,u=a.description;h(),function(n,r){return fetch("https://mesto.nomoreparties.co/v1/".concat(t,"/users/me"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:e},body:JSON.stringify({name:n,about:r})}).then(o)}(i,u).then(function(){q()}).finally(function(){h(),r.textContent=c})}function x(e){var n=e.target.querySelector(".popup__button"),a=n.textContent;n.textContent="Сохранение...",e.preventDefault();var i,u,s=L(e.target);i=s["place-name"],u=s.link,function(e,n){return fetch("https://mesto.nomoreparties.co/v1/".concat(t,"/cards"),{method:"POST",body:JSON.stringify({name:e,link:n}),headers:{"Content-Type":"application/json",authorization:"18e65fe6-f22e-4549-8c48-91a029fe4686"}}).then(o)}(i,u).then(function(t){r.prepend(c(t.link,t.name,t.likes,t.owner,t._id))}).catch(function(t){console.error("Ошибка создания карточки:",t)}),e.target.reset(),h(),n.textContent=a}function w(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function c(n,o,r,c){var u=o&&o.prototype instanceof i?o:i,s=Object.create(u.prototype);return T(s,"_invoke",function(n,o,r){var c,i,u,s=0,l=r||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return c=e,i=0,u=t,p.n=n,a}};function f(n,o){for(i=n,u=o,e=0;!d&&s&&!r&&e<l.length;e++){var r,c=l[e],f=p.p,_=c[2];n>3?(r=_===o)&&(u=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=f&&((r=n<2&&f<c[1])?(i=0,p.v=o,p.n=c[1]):f<_&&(r=n<3||c[0]>o||o>_)&&(c[4]=n,c[5]=o,p.n=_,i=0))}if(r||n>1)return a;throw d=!0,o}return function(r,l,_){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,_),i=l,u=_;(e=i<2?t:u)||!d;){c||(i?i<3?(i>1&&(p.n=-1),f(i,u)):p.n=u:p.v=u);try{if(s=2,c){if(i||(r="next"),e=c[r]){if(!(e=e.call(c,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=c.return)&&e.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),i=1);c=t}else if((e=(d=p.n<0)?u:n.call(o,p))!==a)break}catch(e){c=t,i=1,u=e}finally{s=1}}return{value:e,done:d}}}(n,r,c),!0),s}var a={};function i(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][o]?e(e([][o]())):(T(e={},o,function(){return this}),e),d=s.prototype=i.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,T(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=s,T(d,"constructor",s),T(s,"constructor",u),u.displayName="GeneratorFunction",T(s,r,"GeneratorFunction"),T(d),T(d,r,"Generator"),T(d,o,function(){return this}),T(d,"toString",function(){return"[object Generator]"}),(w=function(){return{w:c,m:p}})()}function T(t,e,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}T=function(t,e,n,o){function c(e,n){T(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(c("next",0),c("throw",1),c("return",2))},T(t,e,n,o)}function j(t,e,n,o,r,c,a){try{var i=t[c](a),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(o,r)}document.querySelector(".header__logo").src="fc3e6875d825f899a98d.svg";var O=document.forms["edit-profile"],P=document.forms["new-place"],A=O.description,z=O.name,I=document.forms["upd-avatar"],D=document.querySelector(".profile__add-button"),G=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__image");function F(){v.forEach(function(t){t.addEventListener("click",function(){h()})}),N.addEventListener("click",function(t){m(_)}),I.addEventListener("submit",function(n){!function(n){var r,c=n.target.querySelector(".popup__button"),a=c.textContent;c.textContent="Сохранение...",n.preventDefault(),(r=L(n.target)["avatar-url"],fetch("https://nomoreparties.co/v1/".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:e},body:JSON.stringify({avatar:r})}).then(o)).then(function(){n.target.reset(),q()}).finally(function(){h(),c.textContent=a})}(n)}),G.addEventListener("click",function(){z.value=k.textContent,A.value=E.textContent,m(f)}),P.addEventListener("submit",x),O.addEventListener("submit",C),D.addEventListener("click",function(){m(d)}),r.addEventListener("click",function(n){var r,c=n.target.closest(".card");n.target.classList.contains("card__like-button")?(n.stopPropagation(),i(c)?s(c):u(c),i(c)?(r=c.dataset.cardId,fetch("https://nomoreparties.co/v1/".concat(t,"/cards/likes/").concat(r),{method:"PUT",headers:{authorization:e}}).then(o)).catch(function(t){i(c)?s(c):u(c)}):function(n){return fetch("https://nomoreparties.co/v1/".concat(t,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:e}}).then(o)}(c.dataset.cardId).catch(function(t){i(c)?s(c):u(c)})):n.target.classList.contains("card__delete-button")?(function(n){fetch("https://nomoreparties.co/v1/".concat(t,"/cards/").concat(n),{method:"DELETE",headers:{authorization:e}})}(c.dataset.cardId),c.remove()):n.target.classList.contains("card__image")&&(p.querySelector(".popup__image").src=n.target.src,p.querySelector(".popup__caption").textContent=n.target.alt,m(p))})}function H(){var t;return t=w().m(function t(){var e,o;return w().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:e=t.v,q(),a(e),t.n=3;break;case 2:t.p=2,o=t.v,console.error(o);case 3:return t.a(2)}},t,null,[[0,2]])}),H=function(){var e=this,n=arguments;return new Promise(function(o,r){var c=t.apply(e,n);function a(t){j(c,o,r,a,i,"next",t)}function i(t){j(c,o,r,a,i,"throw",t)}a(void 0)})},H.apply(this,arguments)}(function(){return H.apply(this,arguments)})().then(function(){F(),Array.from(document.querySelectorAll(".popup__form")).forEach(function(t){return function(t){var e=Array.from(t.querySelectorAll(".popup__input")),n=t.querySelector(".popup__button");e.forEach(function(o){o.addEventListener("input",function(){!function(t,e){var n=t.querySelector("#".concat(e.id,"-error"));e.validity.valid?(function(t){t.classList.remove("popup__input_type_error")}(e),n.textContent=""):(function(t){t.classList.add("popup__input_type_error")}(e),n.textContent=e.validationMessage)}(t,o),l(e,n)})}),l(e,n)}(t)})})})();