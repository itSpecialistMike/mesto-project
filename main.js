/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},e={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"18e65fe6-f22e-4549-8c48-91a029fe4686","Content-Type":"application/json"}},n=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).then(function(t){return t})},r=document.querySelector(".places__list");function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=document.querySelector("#card-template").content.cloneNode(!0);c&&n.some(function(t){return t._id===c._id})&&a.querySelector(".card__like-button").classList.add("card__like-button_is-active"),a.querySelector(".card").dataset.cardId=o,a.querySelector(".card__image").src=t,a.querySelector(".card__image").alt=e,a.querySelector(".card__title").textContent=e,a.querySelector(".card__likes").textContent=n.length;var i=a.querySelector(".card__delete-button");return c?r&&r._id!==c._id&&(i.style.display="none"):i.style.display="none",a}function c(n){r.innerHTML="",fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then(function(t){t.forEach(function(t){r.append(o(t.link,t.name,t.likes,t.owner,t._id,n))})}).catch(function(t){console.error("Ошибка загрузки карточек:",t)})}function a(t){return t.querySelector(".card__like-button").classList.contains("card__like-button_is-active")}function i(t){var e=t.querySelector(".card__like-button"),n=t.querySelector(".card__likes");e.classList.add("card__like-button_is-active"),n.textContent=parseInt(n.textContent)+1}function u(t){var e=t.querySelector(".card__like-button"),n=t.querySelector(".card__likes");e.classList.remove("card__like-button_is-active"),n.textContent=parseInt(n.textContent)-1}function l(t,e){var n=t.every(function(t){return t.validity.valid});e.disabled=!n,e.classList.toggle("popup__button_disabled",!n)}var s=document.querySelector(".popup_type_new-card"),d=document.querySelector(".popup_type_image"),p=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_updAvatar"),_=document.querySelectorAll(".popup__close");function y(t){"Escape"===t.key&&h()}function v(t){t.classList.add("popup_is-opened"),document.body.style.overflow="hidden",document.addEventListener("keydown",y)}function h(){document.querySelectorAll(".popup_is-opened").forEach(function(t){return t.classList.remove("popup_is-opened")}),document.body.style.overflow="",document.removeEventListener("keydown",y)}document.querySelectorAll(".popup").forEach(function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",function(e){e.target===t&&h()})});var m=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),g=function(){n().then(function(t){m.textContent=t.name,b.textContent=t.about,S.style.backgroundImage="url(".concat(t.avatar,")")}).then(function(t){}).catch(function(t){console.error("Ошибка загрузки профиля:",t)})},q=document.querySelector(".profile__title"),k=document.querySelector(".profile__description");function E(t){var e=new FormData(t);return Object.fromEntries(e)}function L(n){var r=n.target.querySelector(".popup__button"),o=r.textContent;r.textContent="Сохранение...",n.preventDefault();var c=E(n.target),a=c.name,i=c.description;h(),function(n,r){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then(t)}(a,i).then(function(){g(),h()}).finally(function(){r.textContent=o})}function x(n){var c=n.target.querySelector(".popup__button"),a=c.textContent;c.textContent="Сохранение...",n.preventDefault();var i,u,l=E(n.target);i=l["place-name"],u=l.link,function(n,r){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})}).then(t)}(i,u).then(function(t){r.prepend(o(t.link,t.name,t.likes,t.owner,t._id))}).catch(function(t){console.error("Ошибка создания карточки:",t)}),n.target.reset(),h(),c.textContent=a}function C(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function c(n,r,o,c){var u=r&&r.prototype instanceof i?r:i,l=Object.create(u.prototype);return w(l,"_invoke",function(n,r,o){var c,i,u,l=0,s=o||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return c=e,i=0,u=t,p.n=n,a}};function f(n,r){for(i=n,u=r,e=0;!d&&l&&!o&&e<s.length;e++){var o,c=s[e],f=p.p,_=c[2];n>3?(o=_===r)&&(u=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=f&&((o=n<2&&f<c[1])?(i=0,p.v=r,p.n=c[1]):f<_&&(o=n<3||c[0]>r||r>_)&&(c[4]=n,c[5]=r,p.n=_,i=0))}if(o||n>1)return a;throw d=!0,r}return function(o,s,_){if(l>1)throw TypeError("Generator is already running");for(d&&1===s&&f(s,_),i=s,u=_;(e=i<2?t:u)||!d;){c||(i?i<3?(i>1&&(p.n=-1),f(i,u)):p.n=u:p.v=u);try{if(l=2,c){if(i||(o="next"),e=c[o]){if(!(e=e.call(c,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=c.return)&&e.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);c=t}else if((e=(d=p.n<0)?u:n.call(r,p))!==a)break}catch(e){c=t,i=1,u=e}finally{l=1}}return{value:e,done:d}}}(n,o,c),!0),l}var a={};function i(){}function u(){}function l(){}e=Object.getPrototypeOf;var s=[][r]?e(e([][r]())):(w(e={},r,function(){return this}),e),d=l.prototype=i.prototype=Object.create(s);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,w(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=l,w(d,"constructor",l),w(l,"constructor",u),u.displayName="GeneratorFunction",w(l,o,"GeneratorFunction"),w(d),w(d,o,"Generator"),w(d,r,function(){return this}),w(d,"toString",function(){return"[object Generator]"}),(C=function(){return{w:c,m:p}})()}function w(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}w=function(t,e,n,r){function c(e,n){w(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(c("next",0),c("throw",1),c("return",2))},w(t,e,n,r)}function O(t,e,n,r,o,c,a){try{var i=t[c](a),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}document.querySelector(".header__logo").src="fc3e6875d825f899a98d.svg";var T=document.forms["edit-profile"],j=document.forms["new-place"],P=T.description,A=T.name,U=document.forms["upd-avatar"],I=document.querySelector(".profile__add-button"),D=document.querySelector(".profile__edit-button"),G=document.querySelector(".profile__image");function N(){_.forEach(function(t){t.addEventListener("click",function(){h()})}),G.addEventListener("click",function(){v(f)}),U.addEventListener("submit",function(n){!function(n){var r,o=n.target.querySelector(".popup__button"),c=o.textContent;o.textContent="Сохранение...",n.preventDefault(),(r=E(n.target)["avatar-url"],fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then(function(){n.target.reset(),g(),h()}).finally(function(){o.textContent=c})}(n)}),D.addEventListener("click",function(){A.value=q.textContent,P.value=k.textContent,v(p)}),j.addEventListener("submit",x),T.addEventListener("submit",L),I.addEventListener("click",function(){v(s)}),r.addEventListener("click",function(n){var r,o=n.target.closest(".card");n.target.classList.contains("card__like-button")?(n.stopPropagation(),a(o)?u(o):i(o),a(o)?(r=o.dataset.cardId,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:e.headers}).then(t)).catch(function(){a(o)?u(o):i(o)}):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(o.dataset.cardId).catch(function(){a(o)?u(o):i(o)})):n.target.classList.contains("card__delete-button")?(function(n){fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(o.dataset.cardId),o.remove()):n.target.classList.contains("card__image")&&(d.querySelector(".popup__image").src=n.target.src,d.querySelector(".popup__caption").textContent=n.target.alt,v(d))})}function F(){var t;return t=C().m(function t(){var e,r;return C().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:e=t.v,g(),c(e),t.n=3;break;case 2:t.p=2,r=t.v,console.error(r);case 3:return t.a(2)}},t,null,[[0,2]])}),F=function(){var e=this,n=arguments;return new Promise(function(r,o){var c=t.apply(e,n);function a(t){O(c,r,o,a,i,"next",t)}function i(t){O(c,r,o,a,i,"throw",t)}a(void 0)})},F.apply(this,arguments)}(function(){return F.apply(this,arguments)})().then(function(){N(),Array.from(document.querySelectorAll(".popup__form")).forEach(function(t){return function(t){var e=Array.from(t.querySelectorAll(".popup__input")),n=t.querySelector(".popup__button");e.forEach(function(r){r.addEventListener("input",function(){!function(t,e){var n=t.querySelector("#".concat(e.id,"-error"));e.validity.valid?(function(t){t.classList.remove("popup__input_type_error")}(e),n.textContent=""):(function(t){t.classList.add("popup__input_type_error")}(e),n.textContent=e.validationMessage)}(t,r),l(e,n)})}),l(e,n)}(t)})})})();